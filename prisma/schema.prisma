generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                  String    @id @default(uuid())
  email               String    @unique
  password            String
  name                String?
  role                String    @default("CLIENT")
  phone               String?
  address             String?
  balance             Decimal   @default(0)
  isRetailer          Boolean   @default(false)
  surchargePercentage Decimal   @default(0)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  allowedCategories   String[]  @default([])
  orders              Order[]
  payments            Payment[]
}

model Product {
  id           String           @id @default(cuid())
  name         String
  description  String?
  imageUrl     String?
  category     String?
  subcategory  String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  ledSurcharge Decimal          @default(0)
  basePrice    Decimal          @default(0)
  variants     ProductVariant[]
}

model ProductVariant {
  id         String      @id @default(uuid())
  productId  String
  name       String
  price      Decimal?    @default(0)
  imageUrl   String?
  orderItems OrderItem[]
  product    Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Order {
  id        String      @id @default(uuid())
  userId    String
  status    String      @default("PENDING")
  total     Decimal
  notes     String?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id])
  items     OrderItem[]
}

model OrderItem {
  id                   String         @id @default(uuid())
  orderId              String
  variantId            String
  quantity             Int
  deliveredQuantity    Int            @default(0)
  price                Decimal
  isReady              Boolean        @default(false)
  buttonsType          String         @default("COMMON")
  ledSurchargeSnapshot Decimal        @default(0)
  order                Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  variant              ProductVariant @relation(fields: [variantId], references: [id])
}

model Payment {
  id        String   @id @default(uuid())
  userId    String
  orderId   String?
  amount    Decimal
  type      String
  method    String
  notes     String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}
